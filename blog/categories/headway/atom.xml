<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Headway | Near Improv]]></title>
  <link href="http://alpha-beta-soup.github.io/blog/categories/headway/atom.xml" rel="self"/>
  <link href="http://alpha-beta-soup.github.io/"/>
  <updated>2014-06-17T14:09:12+12:00</updated>
  <id>http://alpha-beta-soup.github.io/</id>
  <author>
    <name><![CDATA[Richard Law]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[What is a Headway?]]></title>
    <link href="http://alpha-beta-soup.github.io/blog/2014/06/17/what-is-a-headway/"/>
    <updated>2014-06-17T08:38:41+12:00</updated>
    <id>http://alpha-beta-soup.github.io/blog/2014/06/17/what-is-a-headway</id>
    <content type="html"><![CDATA[<p>A headway, as used in transit planning and modelling, is typically defined as the time
between consecutive services. If you catch a bus that &ldquo;comes every half hour&rdquo;, then
the service you catch has a headway of 30 minutes.</p>

<p>This concept is deceptively simple, and this blog post will explain why. There are
several examples of transit analyses that I have seen that use an incorrect definition
of the headway.</p>

<p>Defining the headway accurately is very important when modelling travel using public
transport because it is used to determine how long we expect passengers will wait.
Taking the example of the bus that comes every thirty minutes: if passengers all turn up
to the stop without considering the schedule (that is, at random), we would expect the
average passenger to be waiting there for a period of time equal to half the headway:
15 minutes.</p>

<p>The Transit Capacity and Quality of Service Manual (<a href="http://onlinepubs.trb.org/onlinepubs/tcrp/tcrp100/part%203.pdf" title="TCQSM 2nd Edition, PDF">TCQSM</a>) has a pretty handy table on
different headway classes and what they mean for waiting passengers. I&rsquo;ve taken this from
the second edition of the TCQSM (rather than the 3rd), because I don&rsquo;t have access to the
3rd edition. I don&rsquo;t know if it has changed (a heads-up if it has would be great).</p>

<table>
<thead>
<tr>
<th align="center">Level of Service (LOS) </th>
<th align="center">  Avg. Headway (min)  </th>
<th align="center">  Vehicles/h  </th>
<th> Comments</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">A </td>
<td align="center"> &lt;10 </td>
<td align="center"> >6 </td>
<td> Passengers do not need schedules</td>
</tr>
<tr>
<td align="center">B </td>
<td align="center"> 10-14 </td>
<td align="center"> 5-6 </td>
<td> Frequent service, passengers consult schedules</td>
</tr>
<tr>
<td align="center">C </td>
<td align="center"> 15-20 </td>
<td align="center"> 3-4 </td>
<td> Maximum desirable time to wait if bus/train missed</td>
</tr>
<tr>
<td align="center">D </td>
<td align="center"> 21-30 </td>
<td align="center"> 2 </td>
<td> Service unattractive to choice riders</td>
</tr>
<tr>
<td align="center">E </td>
<td align="center"> 31-60 </td>
<td align="center"> 1 </td>
<td> Service available during the hour</td>
</tr>
<tr>
<td align="center">F </td>
<td align="center"> >60 </td>
<td align="center"> &lt;1 </td>
<td> Service unattractive to all riders</td>
</tr>
</tbody>
</table>


<p>Stops with LOS A mean that passengers can just up and board their service with barely any waiting.
Stops with LOS F require that passengers take time to plan their arrival at the stop
and probably change their schedules before or after their trip: living their life around the
schedule.</p>

<p>The &ldquo;average headway&rdquo; in the table is the inverse of average frequency.</p>

<p>So far, so good. Headways are the time between vehicles, and are useful as indications
of how frequent a public transport service is, and therefore how long passengers wait.
Average waiting time is complicated by the fact that not all passengers arrive to their
stops at random, but I will not bother you with this for the moment, as this post
is concerned with defining the headway, not waiting time, even if they are related.</p>

<hr />

<h2>Problem 1: Grouped arrivals</h2>

<hr />

<p>If I told you that a particular bus route had a frequency of 3 vehicles per hour,
what would be headway on that route? Well, there&rsquo;s 60 minutes to an hour, and 3 services
in that period. So we have 60/3=20 minute headway.</p>

<p>However what if the schedule (or, you know, reality) had all three of these services arriving
at the same time, perhaps because it is a bus interchange where three routes coincide before
heading their separate ways, or because buses can get caught behind a late service (bunching).
In this case, despite having a frequency of 3 vehicles per hour
(LOS C), your headway could arguably be defined in two ways.</p>

<p>The first is to assume that three services all arriving at once just count as one
arrival. Your headway is then 60 minutes, and LOS E.</p>

<p>The second is to acknowledge that O.K., the schedule says that they arrive at the same
time, but it can&rsquo;t be <em>exactly</em> the same time. Let&rsquo;s say for argument&rsquo;s sake, last
Tuesday they arrived at 7:00 am, 7:01 am, and 7:02 am, and then again at 8 am.
Let&rsquo;s call this Arrival Pattern A.
Your headway as we have so far defined it is one minute for the first bus, one minute for the second,
and 58 minutes for the third. Your average headway in this period is (1+1+58)/3=20 minutes, LOS C.</p>

<p>So we&rsquo;re back at 20 minutes! But hold on, none these buses has a 20 minute headway when considered
as an individual arrival.</p>

<p>This is tricky. What does the TCQSM recommend? Well, as it so happens, the TCQSM
suggests using the first approach, where buses that arrive within three minutes of each other
are considered as one bus. So the 7:00, 7:01 and 7:02 buses would collapse down to some time point
in the range 7:00-7:02. I&rsquo;m not sure what moment exactly should be used within this range.
It may sound picky to be wondering if the representative arrival is 7:00 or 7:02, but
when writing code to calculate these headways for you, you have to make rather precise
decisions. I&rsquo;d guess it&rsquo;d be the average of these values, so 7:01 am.</p>

<p>Whatever it is, here&rsquo;s what the TCQSM has to say (p. 3-29):</p>

<blockquote><p>Some judgment must be applied to bus stops located near timed transfer centers.
There is a considerable difference in service from a passenger’s perspective between a
bus arriving every 10 minutes and three buses arriving in a row from a nearby
transfer center every 30 minutes, even though both scenarios result in six buses per
hour serving the stop. In general, buses on separate routes serving the same
destination that arrive at a stop within 3 minutes of each other should be counted as
one bus for the purposes of determining service frequency LOS."</p></blockquote>

<p>However, if the buses arrived at 7:00, 7:04, 7:08 and 8:00, we&rsquo;d be back to an average headway
of 20 minutes, and square one. We&rsquo;ll call this Arrival Pattern B.</p>

<h3>Median headway</h3>

<p>This issue is why, when aggregating headways (rather than determining the headways of
particular trips) over an interval of time, the median headway is sometimes used
instead of the average headway. With a median headway, the potential to calculate
a headway that is never exhibited in reality is reduced.</p>

<p>For the two examples given in this section, Arrival Pattern A has a median headway of 1 minute.
Arrival Pattern B has a median headway of 4 minutes.</p>

<p>Hmm. That&rsquo;s not quite right, either, is it? If you were to use this as your headway for
the purposes of determining the average waiting time of a randomly-arriving passenger,
they&rsquo;d be waiting for 0.5 minutes (AP A) or 2 minutes (AP B).</p>

<h3>Is it a problem?</h3>

<p>I got to this point in my thinking and after a bit of time spent smashing my head into
my desk, I asked myself whether it was really a problem if the average headway in Arrival Patterns
A and B can be 60 and 20 minutes, respectively. This seems like a very big difference in headway
(and hence waiting time) for such a small difference in vehicle arrivals.</p>

<p>However, if passengers are arriving uniformly at random over the hour 7:00-8:00,
then the average passenger <em>does</em> indeed wait for 20 minutes in Arrival Pattern B.
In Arrival Pattern A, three minutes, while arbitrary, does seem like a reasonable amount
of time to consider services to be functionally arriving at the same time, given acceptable
levels of variation in arrival time.</p>

<p>That&rsquo;s fine and dandy for little examples like AP A and B above. But what if you
have a major stop where buses typically arrive every minute for the entire hour?
What is the headway? We&rsquo;ll call this Arrival Pattern C. In this case, the frequency-derived measurement of headway
(60 arrivals in 60 minutes, so 1 minute headways) is spot-on.</p>

<p>But the TCQSM just told us that arrivals less than 3 minutes apart should be considered
equivalent to the arrival of only one vehicle. So the 7:00 and 7:01 arrivals are equivalent
to each other. And the 7:01 and the 7:02. And the 7:02 and the 7:03. In fact, taking the
TCQSM&rsquo;s advice to the letter (as code written to solve this problem would naïvely), the
whole pattern of arrivals would be reduced down to one single arrival and a headway of
60 minutes for the 7:00-8:00 period!</p>

<h3>What do you do?</h3>

<p>Thinking about these problems, the most defensible solution I have come up with is
to take the TCQSM&rsquo;s grouping advice, but modify it slightly so we don&rsquo;t avoid that
last incomprehensible travesty. I would <em>bin</em> all arrivals into groups of four minutes.
So for Arrival Pattern C (arrivals every minute for an hour), we&rsquo;d see single arrival
events at 7:00, 7:04, 7:08, 7:12, and so on. 60 arrivals would be reduced to 15,
each with four minute headways. The average and the median headways in this case would
then both be four minutes, with an average waiting time of two minutes.</p>

<p>For AP B (7:00, 7:04, 7:08, and 8:00), no modification of the arrivals is required, and
the average headway is 20 minutes.</p>

<p>For AP A (7:00, 7:01, 7:02, and 8:00), we would modify the arrival pattern to be 7:00 and 8:00, as
the three arrivals near the start of the hour are grouped into the same bin. If there was a
fourth service at 7:03, the pattern would be the same, as well as the average headway (60 minutes). When we
get an additional service at 7:04, our (grouped) arrival pattern becomes 7:00, 7:04, 8:00, and <strong>our average
headway becomes 30 minutes</strong> rather than 60. The median also changes from 60 to 30.</p>

<p>This last case may not seem ideal, but let&rsquo;s recap the possible alternatives.</p>

<ol>
<li>A literal interpretation of the TCQSM has us grouping all of the first five arrivals into
one, leading to only one headway of <strong>60 minutes</strong>.</li>
<li>Without grouping, we&rsquo;d have headways of 1, 1, 1, 1, and 56 minutes, for an average
of <strong>12 minutes</strong>, and a median of 1 minute. Notice that the average headway is the same
as that determined from the frequency per hour (5 arrivals in 60 minutes).</li>
</ol>


<p>Deciding which method to follow is tricky. I don&rsquo;t have a clear favourite; but if forced to pick,
I like the method that uses the bins. It acknowledges the TQCSM&rsquo;s recommendation that
arrivals close in time be considered functionally equivalent, and results in a headway
that falls between the other two estimates derived from alternative interpretations.</p>

<p>From the perspective of someone who has to calculate these values programmatically, it
adds a bit of overhead, particularly over the simple arrivals per hour calculation. However that
calculation does not account for the scheduled arrivals, and I would not recommend it, ever.</p>

<hr />

<h2>Intermission</h2>

<hr />

<p>I apologise that this is a long post; but it&rsquo;s not as simple a problem as it is made out to be.
Here&rsquo;s a cat. Have a bite to eat, flick over to Facebook briefly, but please keep reading, I&rsquo;d
really love to get a different perspective.</p>

<p><span class='caption-wrapper'><img class='caption' src='/images/intermission-kitty.jpg' width='' height='' title=''><span class='caption-text'></span></span></p>

<hr />

<h2>Problem 2: The destination matters</h2>

<hr />

<p>So you&rsquo;re back from your break and here&rsquo;s a surprise. I&rsquo;ve been a little dishonest in my
definition of what a headway is. Well, I&rsquo;ve said a half-truth. The headway <em>is</em> the time
between vehicle arrivals at a stop. However, all arrivals are not equivalent. What matters
is <strong>where they are going</strong>. Let&rsquo;s say we have a network with stops A-E serviced by three different
routes (distinguished by colour and pattern for the colourblind: red is solid, green is dotted, and blue is dashed).</p>

<p><img class="right" src="../images/network-headway-diagram.png"></p>

<p>If you&rsquo;re seeking to travel directly from A to D, you don&rsquo;t at all care that there
is a blue line between A and E. So even if a blue line service arrived at A every minute
of every day, it would do you know good to board it (we&rsquo;ll assume you can&rsquo;t walk between any of the stops).
That is, if travelling A-D, your headway is defined only as the headway of the green route.</p>

<p>Now if you&rsquo;re instead travelling A-C, you can choose between the red and the green routes.
Unless these services arrive at A at the same time, your headway (and hence waiting time)
is less than it would be if you were travelling A-D, even though you are waiting at the same stop.
This path A-B-C is a public transport <em>corridor</em> of overlapping routes.</p>

<p>Travelling A-E, you again benefit from the corridor effect, as your line is shared between A and E.
Note, however, that although these overlapping routes work together to reduce your headway,
you may not necessarily choose to board the first red or blue service that arrives. For instance,
if blue is an express route that travels A-E while red is a slower route that stops at A-B-C-E,
you may be aware that skipping that red bus that just turned up at A in favour of waiting just a little
bit longer for the next blue bus is better, because the blue bus will get you to E in better time.</p>

<p>Given this, what&rsquo;s the headway? If the headway is used as a proxy for waiting time, how
can it account for the presence of express routes that may give people an incentive to wait a little bit
longer for a faster route? Given that you don&rsquo;t <em>know</em> with certainty that the blue bus is
going to turn up quickly enough for your gamble to pay off, what is your expected waiting time?</p>

<p>Further, what about the possibility of taking a green bus to C and then waiting at C for a red
bus to take you all the way to E? Might sound weird given transfers are annoying, but it&rsquo;s
certainly an advantage to have this option if C is more comfortable or well-lit as a place
to wait than is A.</p>

<p>These are very tricky questions with very tricky answers. The key thing to keep in mind, however, is the mantra:
<em>*the destination matters</em>. To this end, the TCQSM does acknowledge that headways are defined
with respect to a particular destination. By no means has this been clearly stated, however.
To quote their fuller definition (p. 3-29):</p>

<blockquote><p>Service frequency LOS is determined &lt;by destination from a given transit stop, as
several routes may serve a given stop, but not all may serve a particular destination.</p></blockquote>

<p>Take home point: a stop served by more than one route with multiple possible destinations
doesn&rsquo;t have &ldquo;a&rdquo; headway. It has a headway for each possible destination from each route.</p>

<h3>How do you calculate headways when the destination matters?</h3>

<p>An issue here, from the perspective of someone who wants to calculate headways from a published
schedule (e.g. from your local GTFS) or from observation of real-time service arrivals,
is that as soon as we define headways not as one number for each stop, but as one
number for each possible board-egress stop pair, the dimensionality of the problem grows.</p>

<p>Given this blog is ostensibly about transit visualisation, I&rsquo;ll make a diagram for this.</p>

<p>This is the exact same sample network as we had before, but now shown in terms of the direct
stop edges that exist. If you&rsquo;re to find the headway of travel A-C, you simply need to look
at the two edges that progress uninterrupted from A to C, and ignore all others. This is convenient.</p>

<p><img class="center" src="../images/network-headway-diagram-logical.png"></p>

<p>The problem with this is that the number of edges we have in the network has grown.
Where before we had 7 edges all holding information in our database (route, time, mode, etc.), we
now have 11. This increase of three doesn&rsquo;t sound big, but the only reason it is small is because
I have drawn a very simply network. Despite being simple, this is still coming up against the limits
of what I can reasonably convey in an diagram, what with its overlapping lines.</p>

<p>If instead of 5 stops I had drawn 60 stops, the number of edges now represented would be approximately
half of the number of stops squared (see below equation). For instance, in a 60-stop route, the first stop now has 59 edges leaving from it.
The second would have 58, the third 57, and so on. Before we changed to this representation,
we had <strong>59</strong> edges. Now there&rsquo;s <strong>1770</strong>. Across an entire transport network of
thousands of stops and overlapping routes, where before we had thousands of edges, we now have thousands of millions and you&rsquo;re looking at moving
from a database less than one GB in size to one in the tens of GBs or more, depending on how
exactly you choose to structure and aggregate your data.</p>

<p><img src="http://www.sciweavers.org/tex2img.php?eq=%5Cfrac%7Bstops%5E%7B2%7D%7D%7B2%7D-%28stops-0.5%5Ctimes%20stops%29%7D&amp;bc=White&amp;fc=Black&amp;im=jpg&amp;fs=12&amp;ff=arev&amp;edit=0" alt="equation" /></p>

<p>This problem is tractable (although takes a bit of crafty SQL) for a schedule or small
database of real-time observations. If you want to calculate the average travel time, or headway
or some other parameter for each of the millions of edges in this reconfigured network representing several years,
you&rsquo;ve got your work cut out for you. Unfortunately, that&rsquo;s exactly where I find myself.</p>

<hr />

<h2>Problem 3: What is the headway of the last service?</h2>

<hr />

<p>Imagine you have a commuter service that is scheduled to arrive at your stop at 7:00 and then 7:30
in the morning. What is the headway? Well, for the 7:00 service, it&rsquo;s half an hour. That&rsquo;s fair.
But the 7:30 service? Assuming there&rsquo;s a 7:00 service tomorrow, your headway is 23 hours and 30 minutes,
right?</p>

<p>Plug that in to your script for calculating headways and you now have an average headway
of twelve hours. Enjoying your 6 hour wait, average passenger?</p>

<p>If using headways to get an average waiting time, one would presumably have a ceiling
on the waiting time. Especially when the headways are such that you&rsquo;d be mad or critically uninformed
not to check the schedule.</p>

<p>Why have I never seen this problem mentioned? I don&rsquo;t see it in the TCQSM. I don&rsquo;t see it
in any academic paper that has used &ldquo;headway&rdquo; as those it is something you can touch with your hands?</p>

<p>Given I&rsquo;m facing this issue, what do I do? I can&rsquo;t be the only who has thought about it.</p>

<hr />

<h2>Conclusion</h2>

<hr />

<p>If I had a nickel for every time I&rsquo;ve read a paper where someone
has constructed a computer model of a public transport network and simply said:</p>

<blockquote><p>Waiting time is calculated as half of the headway.</p></blockquote>

<p>I&rsquo;d have very many nickels. The headway <strong>of what</strong>? Have you considered overlapping routes?
Did you calculate the headway as a mean or a median? Over what time interval? What did you
do if one of the arrivals is the last one for the day?</p>

<p>Calculating a headway is deceptively simple. If you get into the business of calculating
them for whatever purpose, I implore you to clearly state exactly what you did to calculate them.
Talk about corner cases. Talk about how you wrote your program to calculate them efficiently
as pairs of stops.</p>

<p>Because I&rsquo;ll have your head if you tell me that you used &ldquo;the headway&rdquo; and leave it at that.</p>

<h3>Care to weigh in?</h3>

<p>Have you dealt with calculating headways from schedules or real-time observations of transit arrivals?</p>

<p>What issues did you come across? How did you deal with them?</p>
]]></content>
  </entry>
  
</feed>
