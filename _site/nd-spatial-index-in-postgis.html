<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>3D spatial indexes in PostGIS<br><small>And even 4D spatio-teporal indexes!</small></title>
  <meta name="description" content="I have just watched Paul Ramsay’s (CartoDB) breakout presentation from PGConf Silicon Valley 2015. I love watching these kinds of videos. They’re reasonably ...">


  <link rel="stylesheet" href="/blog/css/tufte.css">	
  

  <!-- Google Fonts loaded here depending on setting in _data/options.yml true loads font, blank does not-->
  
    <link href='//fonts.googleapis.com/css?family=Lato:400,400italic' rel='stylesheet' type='text/css'>
  
  <!-- Load up MathJax script if needed ... specify in /_data/options.yml file-->
  
    <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  

  <link rel="canonical" href="http://www.nearimprov.com/blog/nd-spatial-index-in-postgis">
  <link rel="alternate" type="application/rss+xml" title="nearimprov" href="http://www.nearimprov.com/blog/feed.xml" />
</head>

  <body>
    <!--- Header and nav template site-wide -->
<header>
    <nav class="group">
	<a href="/blog/"><img class="badge" src="/blog/assets/img/new_badge.png" alt="CH"></a>
	
		
		    
		      <a href="/blog/feed.xml"></a>
		    
	    
  	
		
		    
		      <a href="/blog/">blog</a>
		    
	    
  	
		
		    
		      <a href="/blog/about/">About</a>
		    
	    
  	
		
		    
		      <a href="/blog/projects/">Projects</a>
		    
	    
  	
		
  	
	</nav>
</header>

    <article class="group">
      <h1>3d spatial indexes in postgis<br><small>and even 4d spatio-teporal indexes!</small></h1>
<p class="subtitle">December 19, 2015</p>


<p>I have just watched Paul Ramsay’s (CartoDB) breakout presentation from <em>PGConf Silicon Valley 2015</em>. I love watching these kinds of videos. They’re reasonably short (~40 minutes) so are good while you’re eating lunch or killing time. They also tend to have little nuggets of wisdom to solve “gotchas” that for some reason no one has ever told you about. This presentation in particular has lots of these for using PostGIS. One I did not know about was the ability to specify an n-dimensional index in PostGIS. The typical way to construct a two-dimensional GIST index in PostGIS is to do:</p>

<p>```sql</p>

<p>CREATE INDEX idx ON table USING gist(geom);
```</p>

<p>However if you have XYZ or XYZT data and you want to issue queries that take advantage of these additional dimensions with a multidimensional index, you will need:</p>

<p>```sql</p>

<p>CREATE INDEX idx ON table USING gist(geom gist_geometry_ops_nd);
```</p>

<p>The different operator, internally, means that the spatial functions use the <code class="highlighter-rouge">&amp;&amp;&amp;</code> operator, rather than the <code class="highlighter-rouge">&amp;&amp;</code> operator.</p>

<p>I have been thinking recently about trying to get my hands on some LiDAR data. Acquiring this data is apparently very difficult at the moment. But if you use PostGIS, you’re now well-equipped to deal with it… if you can get your hands on it :information_desk_person:</p>

<p>In addition, PostGIS allows you to switch out the geometry library from the Geometry Engine Open Source (GEOS) to the SFCGAL (SF (?) Computational Geometry Algorithms Library). SFCGAL is not as broad as GEOS, so if you do make the switch, internally a lot of your functions will still use GEOS. However, as Paul Ramsay notes, SFCGAL has a bunch of additional functions that GEOS does not. These include some interesting 3D functions:</p>

<ul>
  <li>
    <p><code class="highlighter-rouge">ST_3DIntersection</code></p>
  </li>
  <li>
    <p><code class="highlighter-rouge">ST_Tesselate</code></p>
  </li>
  <li>
    <p><code class="highlighter-rouge">ST_3DArea</code></p>
  </li>
  <li>
    <p><code class="highlighter-rouge">ST_Extrude</code></p>
  </li>
  <li>
    <p><code class="highlighter-rouge">ST_ForceLHR</code></p>
  </li>
  <li>
    <p><code class="highlighter-rouge">ST_Orientation</code></p>
  </li>
  <li>
    <p><code class="highlighter-rouge">ST_Minkowski</code></p>
  </li>
  <li>
    <p><code class="highlighter-rouge">ST_StraightSkeleton</code></p>
  </li>
  <li>
    <p><code class="highlighter-rouge">ST_ApproximateMedialAxis</code></p>
  </li>
</ul>

<p>SFCGAL will need to be compiled, and then activated within PostgreSQL:</p>

<p>```sql</p>

<p>CREATE EXTENSION postgis_sfcgal;
SET postgis.backend = ‘sfcgal’;
```</p>

<p>There is also a dedicated PostgreSQL extension for storing point cloud data: <a href="https://github.com/pgpointcloud/pointcloud">https://github.com/pgpointcloud/pointcloud</a></p>

<p>Also in the video, there is a tricky philosophical question, with important geometric implications (never thought I’d say that): <em>What is the intersection of two disjoint polygons?</em> The sound of a tree falling in the woods? The sound of one hand clapping? Close. It’s a polygon representing the presence of nothing: <code class="highlighter-rouge">POLYGON EMPTY</code>. And empty geometry is not <code class="highlighter-rouge">NULL</code>. It’s actually more like <code class="highlighter-rouge">0</code> (something with no magnitude, but not exactly nothing).</p>

<p>Another way to get <code class="highlighter-rouge">GEOMETRY EMPTY</code> is to use a negative buffer value that is larger than the geometry that is being buffered.</p>

<p><br /></p>
<center><iframe width="65%" height="500" src="http://www.youtube.com/embed/GSuZP89UdGs" frameborder="0" allowfullscreen=""></iframe></center>

<p>What did you find useful from this presentation?</p>

<p>Incidentally, if someone can tell me what the “SF” in SFCGAL stands for, I’d really appreciate it. It’s driving me nuts. (Spatial Functions?)</p>



<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'nearimprov';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

 <!--
<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'nearimprov';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

-->

    </article>
    <span class="print-footer">3D spatial indexes in PostGIS<br><small>And even 4D spatio-teporal indexes!</small> - December 19, 2015 - Richard Law</span>
    <footer>
  <hr class="slender">
  <ul class="footer-links">
    
      <li>
        <a href="//www.twitter.com/alphabeta_soup"><span class="icon-twitter"></span></a>
      </li>
    
      <li>
        <a href="//plus.google.com/+RichardLawNZ"><span class="icon-googleplus"></span></a>
      </li>
    
      <li>
        <a href="//github.com/alpha-beta-soup"><span class="icon-github"></span></a>
      </li>
    
      <li>
        <a href="/blog/feed.xml"><span class="icon-feed"></span></a>
      </li>
    
      <li>
        <a href="mailto:richard.m.law@gmail.com"><span class="icon-mail"></span></a>
      </li>
    
  </ul>
<div class="credits">
<!-- <span>&copy; 2016 &nbsp;&nbsp;RICHARD LAW</span></br> <br> -->
<span>This site is created with the <a href="//github.com/clayh53/tufte-jekyll">Tufte theme </a> for <a href="//jekyllrb.com">Jekyll</a>.</span>
</div>
</footer>

  </body>
</html>
